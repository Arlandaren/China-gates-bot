from twocaptcha import TwoCaptcha
import cv2,base64,time
from PIL import Image, ImageEnhance, ImageFilter
from io import BytesIO
import numpy as np
def process_img(base64_str):
    if base64_str.startswith('data:image'):
        base64_str = base64_str.split(',')[1]

    image_data = base64.b64decode(base64_str)
    image = Image.open(BytesIO(image_data))

    image = image.convert('L')

    enhancer = ImageEnhance.Contrast(image)
    image = enhancer.enhance(1900)

    # image = image.filter(ImageFilter.MedianFilter())

    temp_image_io = BytesIO()
    image.save(temp_image_io, format='PNG')
    temp_image_io.seek(0)

    image_cv = cv2.imdecode(np.frombuffer(temp_image_io.read(), np.uint8), cv2.IMREAD_GRAYSCALE)
    _, binary_image = cv2.threshold(image_cv, 0, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)

    processed_image_io = BytesIO()
    Image.fromarray(binary_image).save(processed_image_io, format='PNG')
    processed_image_io.seek(0)

    processed_base64_str = base64.b64encode(processed_image_io.read()).decode('utf-8')

    return f"data:image/png;base64,{processed_base64_str}"


def captcha(api_key:str,img_url):
    start = time.time()
    img = process_img(img_url)

    solver = TwoCaptcha(api_key)

    try:
        result = solver.normal(img,lang="en",numeric="1")

    except Exception as e:
        print(e)

    else:
        print(f'solved for {time.time()-start}: ' + str(result))

if __name__ == "__main__":
    captcha("16b39a09902b7fa0f7b7c699a0dfce6b", "data:image/png;base64,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")